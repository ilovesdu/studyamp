This code is copy from diff-amp, except for some change in gan_diff to solve the "no attribute gpu" problem.
